!function(e){e.module("authomator",[])}(angular),function(e){function t(){function t(e,t,r,o){return new n(e,t,r,o,i)}var i={authomatorUrl:"",automaticallyRefreshTokens:!0,accessTokenQueryStringKey:"at",identityTokenQueryStringKey:"it",refreshTokenQueryStringKey:"rt",urls:{login:"login"}};this.setOptions=function(t){return e.extend(i,t),this},this.$get=t,t.$inject=["$rootScope","$location","jwtHelpers","queryStringHelpers"]}function n(e,t,n,i,r){this._options=r,this._accessToken=null,this._identityToken=null,this._refreshToken=null,this.init=function(){this._listenForQueryStringKeys(),this._parseUrlOnInstantiation()},this._listenForQueryStringKeys=function(){var t=this;e.$on("$locationChangeStart",function(e,n){t._updateTokensFromQueryString(n)})},this._parseUrlOnInstantiation=function(){var e=t.absUrl();this._updateTokensFromQueryString(e)},this._updateTokensFromQueryString=function(e){var t=i.parseQueryString(e);if(t.hasOwnProperty(this._options.accessTokenQueryStringKey)&&t.hasOwnProperty(this._options.identityTokenQueryStringKey)&&t.hasOwnProperty(this._options.refreshTokenQueryStringKey))return this.setAccessToken(t[this._options.accessTokenQueryStringKey]),this.setIdentityToken(t[this._options.identityTokenQueryStringKey]),this.setRefreshToken(t[this._options.refreshTokenQueryStringKey]),this},this.setAccessToken=function(t){var i=n.decodeToken(t);return this._accessToken=t,e.$emit("authomator.accessTokenUpdated",i),this},this.getAccessToken=function(){return this._accessToken},this.removeAccessToken=function(){this.setAccessToken(null)},this.setIdentityToken=function(t){var i=n.decodeToken(t);return this._identityToken=t,e.$emit("authomator.identityTokenUpdated",i),this},this.getIdentityToken=function(){return this._identityToken},this.removeIdentityToken=function(){this.setIdentityToken(null)},this.setRefreshToken=function(t){var i=n.decodeToken(t);return this._refreshToken=t,e.$emit("authomator.refreshTokenUpdated",i),this},this.getRefreshToken=function(){return this._refreshToken},this.removeRefreshToken=function(){this.setRefreshToken(null)},this.getLoginUrl=function(){return this._prefixUrl(this._options.urls.login)},this._prefixUrl=function(e){var t=this._options.authomatorUrl;return t?("/"!==t.charAt(t.length-1)&&(t+="/"),t+e):e},this.init()}function i(e){e.init()}i.$inject=["authomator"],e.module("authomator").run(i),e.module("authomator").provider("authomator",t)}(angular),function(e){function t(e){this.urlBase64Decode=function(t){var n=t.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}return e.decodeURIComponent(e.escape(e.atob(n)))},this.decodeToken=function(e){if(!e||!e.split)return null;var t,n=e.split(".");return 3!==n.length?null:(t=this.urlBase64Decode(n[1]),t?JSON.parse(t):null)},this.getTokenExpirationDate=function(e){var t=this.decodeToken(e);if(!t.exp)return null;var n=new Date(0);return n.setUTCSeconds(t.exp),n},this.isTokenExpired=function(e){var t=this.getTokenExpirationDate(e);return t?t.valueOf()<=(new Date).valueOf():!1}}t.$inject=["$window"],e.module("authomator").service("jwtHelpers",t)}(angular),function(e){function t(){this.tryDecodeURIComponent=function(e){try{return decodeURIComponent(e)}catch(t){}},this.parseKeyValue=function(t){var n,i,r=this,o={};return e.forEach((t||"").split("&"),function(t){if(t&&(n=t.replace(/\+/g,"%20").split("="),i=r.tryDecodeURIComponent(n[0]),e.isDefined(i))){var s=e.isDefined(n[1])?r.tryDecodeURIComponent(n[1]):!0;Object.hasOwnProperty.call(o,i)?e.isArray(o[i])?o[i].push(s):o[i]=[o[i],s]:o[i]=s}}),o},this.parseQueryString=function(e){var t="";return e&&e.split&&(t=e.split("?")[1]),this.parseKeyValue(t)}}t.$inject=["$window"],e.module("authomator").service("queryStringHelpers",t)}(angular);